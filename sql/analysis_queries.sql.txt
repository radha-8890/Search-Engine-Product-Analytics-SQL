SELECT COUNT(*) AS total_users FROM google_users;
SELECT COUNT(*) AS total_searches FROM searches;
SELECT COUNT(*) AS total_clicks FROM clicks;
SELECT COUNT(*) AS total_ad_clicks FROM ad_clicks;

SELECT SUM(a.cost) AS total_estimated_revenue
FROM ad_clicks ac
JOIN ads a ON ac.ad_id = a.ad_id;


analysis_queries.sql

-- ================================
-- Section 2: User Engagement Analysis
-- ================================

-- 1. Top 10 most active users by number of searches
SELECT u.user_id, u.name, COUNT(s.search_id) AS total_searches
FROM google_users u
JOIN searches s ON u.user_id = s.user_id
GROUP BY u.user_id, u.name
ORDER BY total_searches DESC
LIMIT 10;

-- 2. Average number of searches per user
SELECT 
    COUNT(*) / (SELECT COUNT(*) FROM google_users) AS avg_searches_per_user
FROM searches;

-- 3. Users who never performed any search
SELECT u.user_id, u.name
FROM google_users u
LEFT JOIN searches s ON u.user_id = s.user_id
WHERE s.search_id IS NULL;

-- 4. Most engaged users (searches + ad clicks)
SELECT 
    u.user_id,
    u.name,
    COUNT(DISTINCT s.search_id) AS searches,
    COUNT(DISTINCT ac.ad_click_id) AS ad_clicks,
    (COUNT(DISTINCT s.search_id) + COUNT(DISTINCT ac.ad_click_id)) AS engagement_score
FROM google_users u
LEFT JOIN searches s ON u.user_id = s.user_id
LEFT JOIN ad_clicks ac ON u.user_id = ac.user_id
GROUP BY u.user_id, u.name
ORDER BY engagement_score DESC
LIMIT 10;

-- 5. Engagement ranking using window function
SELECT 
    u.user_id,
    u.name,
    COUNT(s.search_id) AS total_searches,
    RANK() OVER (ORDER BY COUNT(s.search_id) DESC) AS engagement_rank
FROM google_users u
LEFT JOIN searches s ON u.user_id = s.user_id
GROUP BY u.user_id, u.name;


-- ================================
-- Section 3: Ad Performance & Revenue Optimization
-- ================================

-- 1. Top 10 ads by total clicks
SELECT 
    a.ad_id,
    a.company,
    COUNT(ac.ad_click_id) AS total_clicks
FROM ads a
JOIN ad_clicks ac ON a.ad_id = ac.ad_id
GROUP BY a.ad_id, a.company
ORDER BY total_clicks DESC
LIMIT 10;

-- 2. Revenue generated by each company
SELECT 
    a.company,
    ROUND(SUM(a.cost), 2) AS total_revenue
FROM ads a
JOIN ad_clicks ac ON a.ad_id = ac.ad_id
GROUP BY a.company
ORDER BY total_revenue DESC;

-- 3. Top 10 highest revenue ads
SELECT 
    a.ad_id,
    a.company,
    ROUND(SUM(a.cost), 2) AS revenue
FROM ads a
JOIN ad_clicks ac ON a.ad_id = ac.ad_id
GROUP BY a.ad_id, a.company
ORDER BY revenue DESC
LIMIT 10;

-- 4. Average cost per click
SELECT 
    ROUND(AVG(a.cost), 2) AS avg_cost_per_click
FROM ads a
JOIN ad_clicks ac ON a.ad_id = ac.ad_id;

-- 5. High value users (users who clicked most ads)
SELECT 
    u.user_id,
    u.name,
    COUNT(ac.ad_click_id) AS ad_clicks
FROM google_users u
JOIN ad_clicks ac ON u.user_id = ac.user_id
GROUP BY u.user_id, u.name
ORDER BY ad_clicks DESC
LIMIT 10;

-- ================================
-- Section 4: Growth & Business Insights
-- ================================

-- 1. Most valuable search queries (based on ad revenue generated)
SELECT 
    s.query,
    ROUND(SUM(a.cost), 2) AS total_revenue
FROM searches s
JOIN ad_clicks ac ON s.user_id = ac.user_id
JOIN ads a ON ac.ad_id = a.ad_id
GROUP BY s.query
ORDER BY total_revenue DESC
LIMIT 10;

SELECT 
    u.user_id,
    u.name,
    ROUND(SUM(COALESCE(a.cost,0)), 2) AS total_revenue
FROM google_users u
LEFT JOIN ad_clicks ac ON u.user_id = ac.user_id
LEFT JOIN ads a ON ac.ad_id = a.ad_id
GROUP BY u.user_id, u.name
ORDER BY total_revenue DESC
LIMIT 10;

SELECT 
    ROUND(
        SUM(COALESCE(a.cost,0)) / COUNT(DISTINCT u.user_id),
        2
    ) AS avg_revenue_per_user
FROM google_users u
LEFT JOIN ad_clicks ac ON u.user_id = ac.user_id
LEFT JOIN ads a ON ac.ad_id = a.ad_id;













